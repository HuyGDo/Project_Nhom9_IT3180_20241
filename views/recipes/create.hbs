<main class="create-recipe">
    <div class="create-recipe__container">
        <h1 class="create-recipe__heading">Create New Recipe</h1>

        <form
            action="/recipes/store"
            method="POST"
            class="create-recipe__form"
            enctype="multipart/form-data"
        >
            {{!-- Basic Info --}}
            <div class="form-group">
                <h2 class="section-title">Basic Information</h2>
                <div class="form-group">
                    <label for="recipe-image">Recipe Image</label>
                    <div class="image-upload">
                        <div class="image-upload__preview">
                            <img
                                src="/assets/img/recipe-placeholder.jpg"
                                alt="Recipe preview"
                                id="imagePreview"
                            />
                        </div>
                        <div class="image-upload__input">
                            <input
                                type="file"
                                id="recipe-image"
                                name="recipe-image"
                                accept="image/*"
                                class="image-upload__file"
                                onchange="previewImage(this)"
                            />
                            <label for="recipe-image" class="image-upload__label">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <span>Choose an image</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="title">Recipe Title</label>
                    <input
                        type="text"
                        id="title"
                        name="title"
                        placeholder="Enter your recipe title"
                        required
                    />
                </div>
                <div class="form-group">
                    <label for="description">Recipe Description</label>
                    <textarea
                        id="description"
                        name="description"
                        placeholder="Describe your recipe..."
                        required
                    ></textarea>
                </div>
            </div>

            {{!-- Cooking Info --}}
            <div class="form-group">
                <h2 class="section-title">Cooking Information</h2>
                <div class="create-recipe__form__item--row">
                    <div class="form-group">
                        <label for="prepTime">Prep Time</label>
                        <input
                            type="number"
                            id="prepTime"
                            name="prepTime"
                            placeholder="Minutes"
                            min="0"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="cookTime">Cook Time</label>
                        <input
                            type="number"
                            id="cookTime"
                            name="cookTime"
                            placeholder="Minutes"
                            min="0"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="servings">Servings</label>
                        <input
                            type="number"
                            id="servings"
                            name="servings"
                            placeholder="Number of servings"
                            min="1"
                            required
                        />
                    </div>
                </div>
            </div>

            {{!-- Ingredients --}}
            <div class="form-group">
                <h2 class="section-title">Ingredients</h2>
                <div class="ingredients-list" id="ingredientsList">
                    <div class="ingredient-item">
                        <input
                            type="text"
                            name="ingredients[0][name]"
                            placeholder="Ingredient name"
                            required
                        />
                        <input
                            type="text"
                            name="ingredients[0][quantity]"
                            placeholder="Amount (e.g., 2 cups)"
                            required
                        />
                        <button type="button" class="remove-btn">&times;</button>
                    </div>
                </div>
                <button type="button" class="btn btn--add" id="addIngredient">
                    Add Another Ingredient
                </button>
            </div>

            {{!-- Instructions --}}
            <div class="form-group">
                <h2 class="section-title">Cooking Instructions</h2>
                <div class="instructions-list" id="instructionsList">
                    <div class="instruction-item">
                        <span class="instruction-number">1</span>
                        <input
                            type="text"
                            name="instructions[0][description]"
                            placeholder="Enter cooking instruction"
                            required
                        />
                        <button type="button" class="remove-btn">&times;</button>
                    </div>
                </div>
                <button type="button" class="btn btn--add" id="addInstruction">
                    Add Another Step
                </button>
            </div>

            <div class="create-recipe__form__actions">
                <div class="create-recipe__form__buttons">
                    <button type="submit" class="btn btn--primary create-recipe__form__submit">
                        <i class="fas fa-save"></i>
                        Create Recipe
                    </button>
                    <a
                        href="/recipes/{{ recipe.slug }}"
                        class="btn btn--outline create-recipe__form__cancel"
                    >
                        <i class="fas fa-times"></i>
                        Cancel
                    </a>
                </div>
            </div>
        </form>
    </div>
</main>

<script>
    // Add dynamic fields for ingredients
    const ingredientsList = document.getElementById("ingredientsList");
    const addIngredientBtn = document.getElementById("addIngredient");
    let ingredientCount = 1;

    addIngredientBtn.addEventListener("click", () => {
        const newIngredient = document.createElement("div");
        newIngredient.className = "ingredient-item";
        newIngredient.innerHTML = `
            <input 
                type="text" 
                name="ingredients[${ingredientCount}][name]" 
                placeholder="Ingredient name"
                required
            >
            <input 
                type="text" 
                name="ingredients[${ingredientCount}][quantity]" 
                placeholder="Amount (e.g., 2 cups)"
                required
            >
            <button type="button" class="remove-btn">&times;</button>
        `;
        ingredientsList.appendChild(newIngredient);
        ingredientCount++;
    });

    // Add dynamic fields for instructions
    const instructionsList = document.getElementById("instructionsList");
    const addInstructionBtn = document.getElementById("addInstruction");
    let instructionCount = 1;

    addInstructionBtn.addEventListener("click", () => {
        const newInstruction = document.createElement("div");
        newInstruction.className = "instruction-item";
        newInstruction.innerHTML = `
            <span class="instruction-number">${instructionCount + 1}</span>
            <input 
                type="text" 
                name="instructions[${instructionCount}][description]" 
                placeholder="Enter cooking instruction"
                required
            >
            <button type="button" class="remove-btn">&times;</button>
        `;
        instructionsList.appendChild(newInstruction);
        instructionCount++;
        updateInstructionNumbers();
    });

    function updateInstructionNumbers() {
        const instructions = document.querySelectorAll(".instruction-item");
        instructions.forEach((item, index) => {
            const numberSpan = item.querySelector(".instruction-number");
            if (numberSpan) {
                numberSpan.textContent = index + 1;
            }

            const input = item.querySelector("input");
            if (input) {
                input.name = `instructions[${index}][description]`;
            }
        });
    }

    // Remove items
    document.addEventListener("click", (e) => {
        if (e.target.classList.contains("remove-btn")) {
            e.target.parentElement.remove();
            instructionCount--;
            updateInstructionNumbers();
        }
    });

    function previewImage(input) {
        const preview = document.getElementById("imagePreview");
        const file = input.files[0];

        if (file) {
            const reader = new FileReader();

            reader.onload = function (e) {
                preview.src = e.target.result;
            };

            reader.readAsDataURL(file);
        }
    }
</script>
